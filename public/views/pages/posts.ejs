<!DOCTYPE html>
<html>
<title>HORUS</title>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="public/stylesheets/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Raleway">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="public/stylesheets/timeline.css">
<link href="https://fonts.googleapis.com/css?family=Roboto" rel="stylesheet">
<body class="w3-light-grey w3-content" style="max-width:1600px">

<!-- Sidebar/menu -->
<nav class="w3-sidebar w3-collapse w3-white w3-animate-left" style="    z-index: 3;  width: 30%;  max-width: 500px;  min-width: 300px;  display: block;" id="mySidebar"><br>
  <div class="w3-container">
    <a href="#" onclick="w3_close()" class="w3-hide-large w3-right w3-jumbo w3-padding w3-hover-grey" title="close menu">
      <i class="fa fa-remove"></i>
    </a>
    <img src='<%= data[0].user.profile_picture %>' style="width:45%;  max-width: 100px;" class="w3-round"><br>
    <div style="    margin-left: 130px;font-size: 20px;position: relative;  top: -50px;">
    <a>@<%= data[0].user.username %> <span class="w3-text-grey"><%= data[0].user.full_name %></span> </a>
  </div>

  </div>
  <div class="w3-panel w3-large" style=" display: inline-flex;">
    <p onclick="viewPosts()" style="margin-right: 15px;"><i class="fa fa-th-large fa-fw w3-margin-right"></i>View Post <p>
    <p id="showVideo" onclick="showVideo()" style="margin-right: 15px;"><i class="fa fa-instagram w3-hover-opacity w3-margin-right"></i>  Open Camera</p>
    <p onclick="w3_close()" style="margin-right: 15px;"><i class="fa fa-snapchat w3-hover-opacity w3-margin-right"></i>  Create Post</p>
  </div>
  <div class="w3-bar-block">
    <div id="videoCon" style="display:none;">
      <video id="video" autoplay>No video</video>
      <input type="button" value="Stop" onclick="stopVideo()" id="stopVideo">
    </div>


  </div>
<style>
#scrollingChat{
  height:450px !important;
  max-height: 500px;
}
.form-signin{
  display:none;
}
</style>

  <% include ../pages/index %>
  <div style="height: 40px;
width: 40px;
background: rgb(225, 65, 65) none repeat scroll 0% 0%;
border: 1px solid rgb(255, 223, 223);
border-radius: 50%;
text-align: center;
padding: 4px;">
      <a href="#" onclick="stopAudio()">
        <img height="20px" class="option full" alt="Pause/Stop" src="public/images/mic.png">
      </a>

</div>
  <audio id="audio" preload="auto" tabindex="0" controls="" type="audio/wav" style="display:none;">
  <source src="public/audio/output.wav" type="audio/wav">
      Your browser does not support the audio element.
  </audio>

  <ul id="playlist">
      <li class="active"><a href="public/audio/output.wav">Hello My name is Horus</a></li>
      <% for(var i=0; i< data.length; i++) {  %>
          <li><a href="public/audio/audio<%= data[i].id %>.wav">  <p><%= data[i].caption.text %></p></a></li>
      <% } %>
  </ul>
  <!--  <li><a href="audio/audio1426879371532218745_4338235068.wav">Moonlight Sonata - Beethoven</a></li>
    <li><a href="audio/audio1430312793286085468_4338235068.wav">Canon in D Pachabel</a></li>
    <li><a href="audio/audio1426889306898757399_4338235068.wav">Canon in D Pachabel</a></li>-->
<!--

  <a href="" onclick="viewPosts()" class="w3-bar-item w3-button w3-padding w3-text-teal">></i>VIEW POST</a>
  <a href="#" onclick="w3_close()" class="w3-bar-item w3-button w3-padding"><i class="fa fa-user fa-fw w3-margin-right"></i>CREATE POST</a>
  <a href="#" id="showVideo" onclick="showVideo()" class="w3-bar-item w3-button w3-padding"><i class="fa fa-user fa-fw w3-margin-right"></i>OPEN CAMERA</a>
  <a href="#" onclick="w3_close()" class="w3-bar-item w3-button w3-padding"><i class="fa fa-envelope fa-fw w3-margin-right"></i>LOGOUT</a>
-->
</nav>


<!-- Overlay effect when opening sidebar on small screens -->
<div class="w3-overlay w3-hide-large w3-animate-opacity" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

<!-- !PAGE CONTENT! -->
<div class="w3-main" style="margin-left:470px">

  <!-- Header -->
  <header id="portfolio">
    <a href="#"><img src='<%= data[0].user.profile_picture %>' style="width:65px;" class="w3-circle w3-right w3-margin w3-hide-large w3-hover-opacity"></a>
    <span class="w3-button w3-hide-large w3-xxlarge w3-hover-text-grey" onclick="w3_open()"><i class="fa fa-bars"></i></span>
    <div class="w3-container">
    <h1 class="welcom"><b>HORUS Feed</b></h1>

    <div class="w3-section w3-bottombar w3-padding-16">    <!--
      <span class="w3-margin-right">Filter:</span>
      <button class="w3-button w3-black">ALL</button>
      <button class="w3-button w3-white"><i class="fa fa-diamond w3-margin-right"></i>Design</button>
      <button class="w3-button w3-white w3-hide-small"><i class="fa fa-photo w3-margin-right"></i>Photos</button>
      <button class="w3-button w3-white w3-hide-small"><i class="fa fa-map-pin w3-margin-right"></i>Art</button>-->
    </div>
    </div>
  </header>

    <section class="timeline">
      <div class="container">
          <% for(var i=0; i< data.length; i++) {  if(i%2==1){ var fadeLR = "js--fadeInLeft"; } else {fadeLR = "js--fadeInRight"; }  %>
            <div class="timeline-item" >
              <div class="timeline-img">
              </div>
              <div class="timeline-content timeline-card <%= fadeLR %>">
                  <a class="post" href="<%= data[i].link %>">
                    <img src='<%= data[i].images.standard_resolution.url %>'  alt=" " style="height:300px; width: 100%;" class="w3-hover-opacity">
                  </a>

                <div > </div>

                <div class="postdetail">
                  <p><%= data[i].caption.text %></p>
                  <a class="bnt-more" href="<%= data[i].link %>"> </a>
                  <button class="btn btn-primary" type="button">Likes <span class="badge"><%= data[i].likes.count %></span>
                  </button>
                  <button class="btn btn-primary" type="button">Comments <span class="badge"><%= data[i].comments.count %></span>
                  </button>
                  <input type="hidden" class="postL" id="postList<%= data[i].id %>" value="<%= data[i].id %>">
                </div>

              </div>

            </div>
            <% } %>


      </div>
    </section>


  <!-- Pagination -->
  <div class="w3-center w3-padding-32">
    <div class="w3-bar">
      <a href="#" class="w3-bar-item w3-button w3-hover-black">«</a>
      <a href="#" class="w3-bar-item w3-black w3-button">1</a>
      <a href="#" class="w3-bar-item w3-button w3-hover-black">2</a>
      <a href="#" class="w3-bar-item w3-button w3-hover-black">3</a>
      <a href="#" class="w3-bar-item w3-button w3-hover-black">4</a>
      <a href="#" class="w3-bar-item w3-button w3-hover-black">»</a>
    </div>
  </div>

<!-- End page content -->
</div>

<device type="media" onchange="update(this.data)"></device>
<video autoplay>
</video>

<script
  src="https://code.jquery.com/jquery-3.2.1.js"
  integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE="
  crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/scrollreveal.js/3.3.1/scrollreveal.min.js"></script>
  <script src="public/js/animation.js"></script>


<script>


var audio;
var playlist;
var tracks;
var current;

init();

function init(){
  console.log("Init activated");
 current = 0;
 audio = $('audio');
 playlist = $('#playlist');
 tracks = playlist.find('li a');
 len = tracks.length;
 console.log("# of Tracks"+len);
 audio[0].volume = .50;
 audio[0].play();

 playlist.find('a').click(function(e){
    console.log("Find audio");
     e.preventDefault();
     link = $(this);
     current = link.parent().index();
     run(link, audio[0]);
 });

 audio[0].addEventListener('ended',function(e){
     current++;
     if(current == len){
         current = 0;
         link = playlist.find('a')[0];
     }else{
         link = playlist.find('a')[current];
     }
     run($(link),audio[0]);
 });


}

function run(link, player){
     player.src = link.attr('href');
     par = link.parent();
     par.addClass('active').siblings().removeClass('active');
     audio[0].load();
     audio[0].play();
}

function stopAudio(){
  audio = $('audio');
  audio.pause();
  audio.currentTime = 0;
}


navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia;
var  localStream;
showVideo = function () {
document.getElementById("videoCon").style.display = "block";
   navigator.getUserMedia({
       video: true,
       audio: true
   },

   function (stream) {
       localStream = stream;
       var video = document.getElementById("video");
       video.src = window.webkitURL.createObjectURL(stream);
   },

   // errorCallback
   function (err) {
       console.log("The following error occured: " + err);
   });
}

stopVideo = function () {
   document.getElementById("videoCon").style.display = "none";
   video.src = "";
   video.pause;
   console.log(localStream.getVideoTracks());
   localStream.stop();
}


</script>

</body>
</html>
